fullnameOverride: "argocd"
crds:
  install: true
  # -- Keep CRDs on chart uninstall
  keep: false
configs:
  params:
    server.insecure: true
    controller.diff.server.side: true
  cm:
    statusbadge.enabled: true
    kustomize.buildOptions: "--enable-alpha-plugins --enable-exec  --load-restrictor LoadRestrictionsNone"
  secret:
    argocdServerAdminPassword: $2a$10$GRTeAT.0uRW2HUk59OJn6OjYtWPROWimrka/EGkgDUsiNvmyep05e
    argocdServerAdminPasswordMtime: 2025-08-26T18:15:18
repoServer:
  deploymentAnnotations:
    reloader.stakater.com/auto: "true"
  extraContainers:
    - name: setenv-plugin
      command: [/var/run/argocd/argocd-cmp-server]
      env:
        - name: XDG_CONFIG_HOME
          value: /.config
        - name: SOPS_AGE_KEY_FILE
          value: /.config/sops/age/keys.txt
      envFrom:
        - secretRef:
            name: environment-variables
      image: quay.io/raffaelespazzoli/raffa-envsub:1.1
      securityContext:
        runAsNonRoot: true
        runAsUser: 999
      imagePullPolicy: Always
      volumeMounts:
        - mountPath: /var/run/argocd
          name: var-files
        - mountPath: /home/argocd/cmp-server/plugins
          name: plugins
        - mountPath: /tmp
          name: tmp
        - mountPath: /home/argocd/cmp-server/config/plugin.yaml
          subPath: plugin.yaml
          name: setenv-cmp-plugin
        - mountPath: /usr/local/bin/kustomize
          name: custom-tools
          subPath: kustomize
        - mountPath: /usr/local/bin/ksops
          name: custom-tools
          subPath: ksops
        - mountPath: /.config/sops/age/keys.txt
          name: sops-age
          subPath: keys.txt
  serviceAccount:
    create: true
    name: argocd-repo-server
  rbac:
    - apiGroups:
        - ""
      resources:
        - secrets
      verbs:
        - get
  env:
    - name: XDG_CONFIG_HOME
      value: /.config
    - name: SOPS_AGE_KEY_FILE
      value: /.config/sops/age/keys.txt
  volumes:
    - name: custom-tools
      emptyDir: {}
    - name: sops-age
      secret:
        secretName: helm-secrets-private-keys
    - name: setenv-cmp-plugin
      configMap:
        name: setenv-cmp-plugin
  volumeMounts:
    - mountPath: /usr/local/bin/kustomize
      name: custom-tools
      subPath: kustomize
    - mountPath: /usr/local/bin/ksops
      name: custom-tools
      subPath: ksops
    - mountPath: /.config/sops/age/keys.txt
      name: sops-age
      subPath: keys.txt
  initContainers:
    - name: install-ksops
      image: viaductoss/ksops:v4.3.3@sha256:6b5ec4b6144307f78bcddffd8f09020482836eee34cf77bf4ce8614b0452a73c
      command: ["/bin/sh", "-c"]
      args:
        - echo "Installing KSOPS...";
          mv ksops /custom-tools/;
          mv kustomize /custom-tools/;
          echo "Done.";
      volumeMounts:
        - mountPath: /custom-tools
          name: custom-tools
